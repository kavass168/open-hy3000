// SPDX-License-Identifier: GPL-2.0-or-later
/dts-v1/;

#include "mt7981.dtsi"

/ {
    model = "SiLuo SL3000 eMMC";
    compatible = "silo,sl3000-emmc", "mediatek,mt7981";

    chosen {
        stdout-path = &uart0;
        bootargs = "console=ttyS0,115200n8";
    };

    memory@40000000 {
        device_type = "memory";
        reg = <0x40000000 0x40000000>; /* 1GB DDR4 */
    };

    aliases {
        serial0 = &uart0;
        led-boot = &led_status;
        led-failsafe = &led_status;
        led-running = &led_status;
        led-upgrade = &led_status;
    };

    leds {
        compatible = "gpio-leds";

        led_status: led-status {
            label = "sl3000:green:status";
            gpios = <&gpio 0 GPIO_ACTIVE_HIGH>;
            default-state = "on";
        };
    };

    keys {
        compatible = "gpio-keys";

        reset {
            label = "reset";
            gpios = <&gpio 1 GPIO_ACTIVE_LOW>;
            linux,code = <KEY_RESTART>;
        };
    };
};

/* UART0 */
&uart0 {
    status = "okay";
};

/* 内置交换机 / GMAC */
&eth {
    status = "okay";
};

&switch {
    status = "okay";
};

/* 内置 WiFi（如果板上使用内置 2.4G/5G，可开启） */
&wifi {
    status = "okay";
};

/* PCIe 外置 WiFi MT7976CN（典型接法，占位，后续你可以按实机 GPIO 调整） */
&pcie {
    status = "okay";

    wifi@0,0 {
        compatible = "mediatek,mt76";
        reg = <0 0 0 0 0>;
        mediatek,mtd-eeprom = <&factory 0x0000>;
        ieee80211-freq-limit = <2400000 2500000>, <5150000 5875000>;
    };
};

/* SPI-NOR 32MB：只放 Bootloader / factory / config */
&snfi {
    status = "okay";

    flash@0 {
        compatible = "jedec,spi-nor";
        reg = <0>;
        spi-max-frequency = <52000000>;

        partitions {
            compatible = "fixed-partitions";
            #address-cells = <1>;
            #size-cells = <1>;

            partition@0 {
                label = "bl2";
                reg = <0x00000000 0x00040000>; /* 256KB */
                read-only;
            };

            partition@40000 {
                label = "fip";
                reg = <0x00040000 0x00200000>; /* 2MB */
            };

            factory: partition@240000 {
                label = "factory";
                reg = <0x00240000 0x00200000>; /* 2MB */
                read-only;
            };

            partition@440000 {
                label = "config";
                reg = <0x00440000 0x00100000>; /* 1MB */
            };

            partition@540000 {
                label = "reserved";
                reg = <0x00540000 0x01ac0000>; /* 剩余保留 */
            };
        };
    };
};

/* eMMC 128GB：kernel + rootfs + rootfs_data */
&mmc0 {
    status = "okay";

    bus-width = <8>;
    cap-mmc-highspeed;
    mmc-hs200-1_8v;
    no-sdio;
    no-sd;
    disable-wp;

    vmmc-supply = <&mt7981_vpa_reg>;
    vqmmc-supply = <&mt7981_vpa_reg>;

    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        /* 0x02000000 = 32MB kernel */
        partition@0 {
            label = "kernel";
            reg = <0x00000000 0x02000000>;
        };

        /* 0x20000000 = 512MB rootfs */
        partition@2000000 {
            label = "rootfs";
            reg = <0x02000000 0x20000000>;
        };

        /* 剩余全部给 overlay */
        partition@22000000 {
            label = "rootfs_data";
            reg = <0x22000000 0x00000000>; /* 0 表示用尽剩余空间 */
        };
    };
};
